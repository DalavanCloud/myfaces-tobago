<!--
 * Copyright (c) 2001 Atanion GmbH, Germany
 * All rights reserved.
 * $Id: build_tobago-demo.xml 1092 2004-12-08 10:34:09 +0100 (Mi, 08 Dez 2004) lofwyr $
-->
<project>

  <target name="war" depends="compile" >
    <dependency-list baseDir="" property="list.module" dependencyFile="${basedir}/project.xml" delimiter="," purpose="module"/>
    <dependency-list baseDir="" property="list.war" dependencyFile="${basedir}/project.xml" delimiter="," purpose="war"/>
    <property name="project.control.logging.file"
      value="${log.dir}/${app}.log"/>

    <mkdir dir="${dist}" />

    <default-fetch-dependencies purpose="module"/>
    <default-fetch-dependencies purpose="war"/>
    <property name="module" value="${build}/module" />
    <mkdir dir="${module}" />
    <unjar dest="${module}">
      <fileset dir="lib" includes="${list.module}"/>
    </unjar>

    <!-- copy the templates -->
    <copy todir="${build.config}/${app}" overwrite="true">
      <fileset dir="config/${app}" />
    </copy>
    <!-- replace the templates -->
    <replace
        dir="${build.config}/${app}"
        summary="true" >
      <replacefilter
        token="$${project.control.logging.file}"
        value="${project.control.logging.file}"/>
      <replacefilter
        token="$${tobago-demo.download.serverUrl}"
        value="${tobago-demo.download.serverUrl}"/>
      <replacefilter
        token="$${tomcat.exploded.dir}"
        value="${tomcat.webapp}/${app}"/>
    </replace>
    <!-- build the war-file -->
    <war warfile="${dist}/${app}.war"
         webxml="webapp/${app}/WEB-INF/web.xml">
      <fileset dir="webapp/${app}">
        <include name="**"/>
        <exclude name="WEB-INF/**"/>
      </fileset>
      <fileset dir="${module}">
        <include name="tobago/**"/>
        <include name="tobago-module-client/**"/>
      </fileset>
      <lib dir="lib" includes="${list.war}"/>
      <lib dir="${module}">
        <include name="*.jar"/>
      </lib>
      <!-- Application classes -->
      <classes dir="${build.classes.main}">
        <include name="com/atanion/**/*.class" />
      </classes>
      <classes dir="${src.main}">
        <include name="**/*.properties" />
        <include name="**/*.ser" />
      </classes>
      <!-- get the configured files -->
      <classes dir="${build.config}/${app}">
        <include name="log4j.xml" />
      </classes>
      <webinf dir="webapp/${app}/WEB-INF">
        <include name="**"/>
        <exclude name="web.xml"/>
      </webinf>
      <webinf dir="${build.config}/${app}">
        <include name="faces-config.xml" />
      </webinf>
      <metainf dir="${build.config}/${app}" >
        <include name="context.xml"/>
      </metainf>
    </war>
  </target>

</project>
