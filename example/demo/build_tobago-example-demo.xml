<?xml version="1.0" encoding="UTF-8"?>

<!--
 * Copyright 2002-2005 atanion GmbH.
 *
 *    Licensed under the Apache License, Version 2.0 (the "License");
 *    you may not use this file except in compliance with the License.
 *    You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 *    Unless required by applicable law or agreed to in writing, software
 *    distributed under the License is distributed on an "AS IS" BASIS,
 *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *    See the License for the specific language governing permissions and
 *    limitations under the License.
-->
    
<project>

  <target name="war" depends="compile" >
    <dependency-list baseDir="" property="list.module" dependencyFile="${basedir}/project.xml" delimiter="," purpose="module"/>
    <dependency-list baseDir="" property="list.war" dependencyFile="${basedir}/project.xml" delimiter="," purpose="war"/>

    <mkdir dir="${dist}" />

    <default-fetch-dependencies purpose="module"/>
    <default-fetch-dependencies purpose="war"/>
    <property name="module" value="${build}/module" />
    <mkdir dir="${module}" />
    <unjar dest="${module}">
      <fileset dir="lib" includes="${list.module}"/>
    </unjar>

    <!-- build the war-file -->
    <war warfile="${dist}/${app}.war"
         webxml="webapp/WEB-INF/web.xml">
      <fileset dir="webapp">
        <include name="**"/>
        <exclude name="WEB-INF/**"/>
      </fileset>
      <fileset dir="${module}">
        <include name="tobago/**"/>
        <include name="tobago-module-client/**"/>
      </fileset>
      <lib dir="lib" includes="${list.war}"/>
      <lib dir="${module}">
        <include name="*.jar"/>
      </lib>
      <!-- Application classes -->
      <classes dir="${build.classes.main}">
        <include name="**/*.class" />
      </classes>
      <classes dir="${src.main}">
        <include name="**/*.properties" />
        <include name="**/*.xml" />
      </classes>
      <webinf dir="webapp/WEB-INF">
        <include name="**"/>
        <exclude name="web.xml"/>
      </webinf>
    </war>
  </target>

</project>
