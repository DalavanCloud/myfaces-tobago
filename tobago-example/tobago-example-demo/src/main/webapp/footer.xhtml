<?xml version="1.0" encoding="UTF-8"?>

<!--
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
-->

<f:subview id="footer"
           xmlns:f="http://java.sun.com/jsf/core"
           xmlns:tc="http://myfaces.apache.org/tobago/component"
           xmlns:tx="http://myfaces.apache.org/tobago/extension"
           xmlns:ui="http://java.sun.com/jsf/facelets">

  <tc:panel>
    <f:facet name="layout">
      <tc:gridLayout columns="auto;auto;auto;auto;auto;*" rows="auto;auto"/>
    </f:facet>

    <tc:separator>
      <tc:gridLayoutConstraint columnSpan="6"/>
    </tc:separator>

    <tc:button immediate="true" id="previous"
               image="image/prev.gif"
               action="#{navigation.gotoPrevious}"
               disabled="#{navigation.first}"
               label="#{overviewBundle.footer_previous}"/>

    <tc:button immediate="true" id="next" defaultCommand="true"
               image="image/next.gif"
               action="#{navigation.gotoNext}"
               disabled="#{navigation.last}"
               label="#{overviewBundle.footer_next}"/>

    <tc:button action="#{navigation.viewSource}"
               immediate="true" label="#{overviewBundle.footer_viewSource}"
               target="Source Viewer" transition="false"/>

    <tc:button action="#{pageDeclarationLanguage.asJspx}" disabled="#{pageDeclarationLanguage.jspx}"
               immediate="true" label="As JSP" tip="Use JSP as render technologie"/>

    <tc:button action="#{pageDeclarationLanguage.asFacelets}" disabled="#{pageDeclarationLanguage.facelets}"
               immediate="true" label="As Facelet" tip="Use Facelets as render technologie"/>

    <tc:out value="#{overviewBundle.notTranslated}"/>

    <tc:style>
      .tobago-button-markup-default {
        border-width: 2px;
      }
    </tc:style>

    <tc:script onload="init()">

      function init() {

        jQuery("body").keypress(function (event) {
          var code = event.which;
          if (code == 0) {
            code = event.keyCode;
          }
          if (code == 13) {
            var target = event.target;
            if (target.tagName == "A" || target.tagName == "BUTTON") {
              return;
            }
            if (target.tagName == "TEXTAREA") {
              if (!event.metaKey &amp;&amp; !event.ctrlKey) {
                return;
              }
            }
            var id = target.id;
            while (id != "") {
              var command = jQuery("[data-tobago-default='" + id + "']");
              if (command.size() > 0) {
                LOG.error(code + " on " + id + " command=" + command.attr('id'));
                command.click();
                break;
              }
              id = Tobago.Utils.getNamingContainerId(id);
            }
            return false;
          }
        });

        jQuery("input, select, textarea, a, button").focus(function (event) {
          var target = event.target;
          var id = target.id;
          var command;
          if (target.tagName == "A" || target.tagName == "BUTTON") {
            command = jQuery(target);
          } else {
            while (id != "") {
              command = jQuery("[data-tobago-default='" + id + "']");
              if (command.size() > 0) {
                break;
              }
              id = Tobago.Utils.getNamingContainerId(id);
            }
          }

          if (command.size() > 0) {
            // remove old
            jQuery(".tobago-link-markup-default").removeClass("tobago-link-markup-default");
            jQuery(".tobago-button-markup-default").removeClass("tobago-button-markup-default");

            command.filter("a").addClass("tobago-link-markup-default");
            command.filter("button").addClass("tobago-button-markup-default");
          }
        });
      }

      Tobago.Utils.getNamingContainerId = function (id) {
        return id.substring(0, id.lastIndexOf(":"));
      };

    </tc:script>

  </tc:panel>
</f:subview>
