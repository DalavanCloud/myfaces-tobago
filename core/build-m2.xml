<?xml version="1.0" encoding="UTF-8"?>

<!--
 * Copyright 2002-2005 atanion GmbH.
 *
 *    Licensed under the Apache License, Version 2.0 (the "License");
 *    you may not use this file except in compliance with the License.
 *    You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 *    Unless required by applicable law or agreed to in writing, software
 *    distributed under the License is distributed on an "AS IS" BASIS,
 *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *    See the License for the specific language governing permissions and
 *    limitations under the License.
-->

<project name="tobago" default="jar" xmlns:artifact="urn:maven-artifact-ant">

  <property name="maven.task" value="maven-artifact-ant-2.0-alpha-3-dep.jar"/>
  <available file="${maven.task}" property="maven.task.present"/>

  <property name="build" value="build"/>
  <property name="build.classes.main" value="${build}/classes/main"/>
  <property name="build.classes.test" value="${build}/classes/test"/>
  <property name="build.config" value="${build}/config"/>
  <property name="dist" value="${build}/dist"/>

  <property name="java.source.encoding" value="UTF-8"/>
  <property name="java.version.source" value="1.5"/>
  <property name="java.version.target" value="1.5"/>
  <property name="java.version.bootclasspath" value=""/>
  <property name="java.version.extdirs" value=""/>

  <property name="src.main" value="src/main"/>
  <property name="src.test" value="src/test"/>

  <target name="download-task" unless="maven.task.present">
    <get src="http://www.ibiblio.org/maven2/org/apache/maven/maven-artifact-ant/2.0-alpha-3/${maven.task}"
        dest="${maven.task}"/>
  </target>

  <target name="init-task" depends="download-task">
    <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
      <classpath>
        <pathelement location="${maven.task}"/>
      </classpath>
    </typedef>
  </target>

  <target name="init" depends="init-task">
    <artifact:pom file="pom.xml" id="pom"/>

    <artifact:dependencies filesetId="pom.dependencies" pathId="project.classpath.jar" verbose="false">
      <artifact:pom refid="pom"/>
    </artifact:dependencies>
  </target>

  <target name="compile" depends="fetch-libs">
    <mkdir dir="${build.classes.main}"/>
    <javac srcdir="${src.main}"
      destdir="${build.classes.main}"
      deprecation="on" debug="on"
      encoding="${java.source.encoding}"
      target="${java.version.target}" source="${java.version.source}"
      bootclasspath="${java.version.bootclasspath}"
      extdirs="${java.version.extdirs}" >
      <classpath refid="project.classpath.jar"/>
      <compilerarg value="-Xlint"/>
    </javac>
  </target>

  <target name="fetch-libs" depends="init">
    <mkdir dir="lib"/>
    <copy todir="lib">
      <fileset refid="pom.dependencies"/>
      <flattenmapper/>
    </copy>
  </target>

  <target name="jar" depends="init">
    <jar destfile="deps.jar">
      <fileset refid="pom.dependencies"/>
    </jar>
  </target>

  <target name="clean" description="Delete temporary files.">
    <delete dir="${build}" quiet="true"/>
    <mkdir dir="${build}"/>
  </target>

</project>
